<!--
Interactive Map (30 x 33) - single-file website

How to use:
1. Save this file as `index.html` in the same folder as your map image named `pwnex.png`.
   - If your image has a different name, update `MAP_FILENAME` in the script below.
2. Optional: Create a `players.json` file next to `index.html` to load live data. Format shown below.
   - If `players.json` is missing or fails to load, the page uses a small example dataset embedded in the file.

players.json format (array of objects):
[
  { "name": "Sonsy", "lastActive": "2h ago", "x": 2, "y": 3 },
  { "name": "Kuronaoki", "lastActive": "5d ago", "x": 5, "y": 6 }
]

3. Hosting: Upload `index.html`, `pwnex.png`, and optionally `players.json` to a static host
   - GitHub Pages: Create a repo, add the files to repo root, enable Pages -> main branch / root.
   - Netlify / Vercel: Drag-and-drop the folder or connect the repo.

Notes:
- Grid uses coordinates with x from 0..29 (left to right) and y from 0..32 (top to bottom).
- Hover a tile to show player info. On touch devices tap to show.
- Update players by editing players.json (or edit inside this file's samplePlayers variable).
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Player Map</title>
  <style>
    :root{
      --cols: 30;
      --rows: 33;
      --gap: 0px; /* if you want visible gaps between tiles set this >0 */
    }

    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:#0b0b0b;color:#eee;display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px}

    .site-wrap{max-width:1200px;width:100%;display:flex;flex-direction:column;align-items:center}
    h1{font-size:18px;margin:6px 0}
    p.help{font-size:13px;color:#cfcfcf;margin:0 0 8px}

    /* The map container keeps the map aspect ratio and shows the image as background */
    .map{
      width: min(95vw, 1000px);
      /* aspect-ratio = cols / rows to keep tile alignment */
      aspect-ratio: calc(var(--cols) / var(--rows));
      position:relative;
      background-image: url('pwnex.png'); /* put your map image next to index.html */
      background-size: 100% 100%;
      background-repeat: no-repeat;
      border: 6px solid rgba(255,255,255,0.03);
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      touch-action: manipulation;
      user-select: none;
      overflow:hidden;
      display:grid;
      grid-template-columns: repeat(var(--cols), 1fr);
      grid-template-rows: repeat(var(--rows), 1fr);
      gap: var(--gap);
    }

    .tile{
      position:relative;
      outline: 1px solid rgba(0,0,0,0.0); /* invisible outline that keeps size consistent */
      cursor: crosshair;
    }

    /* Tooltip that appears above tiles */
    .tooltip{
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: -38px;
      background: rgba(0,0,0,0.75);
      color: #fff;
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 13px;
      white-space: nowrap;
      box-shadow: 0 6px 18px rgba(0,0,0,0.7);
      pointer-events: none;
      opacity: 0;
      transition: opacity 120ms ease, transform 120ms ease;
      transform-origin: bottom center;
      z-index: 5;
    }
    .tooltip.visible{opacity:1;transform: translateX(-50%) translateY(-6px)}

    /* small caret under tooltip */
    .tooltip::after{
      content:'';position:absolute;left:50%;bottom:-6px;transform:translateX(-50%);
      border:6px solid transparent;border-top-color: rgba(0,0,0,0.75);
    }

    /* show a subtle highlight on hover to indicate tile detection */
    .tile::before{
      content:'';position:absolute;inset:0;background:transparent;transition:background 120ms ease;pointer-events:none;
    }
    .tile:hover::before{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));}

    /* small legend / instructions */
    .footer{font-size:13px;color:#bfc7c7;margin-top:8px}
    code{background:#0f0f0f;padding:2px 6px;border-radius:4px;font-size:12px}

    @media (max-width:720px){
      h1{font-size:16px}
      .map{width:95vw}
      .tooltip{font-size:12px}
    }
  </style>
</head>
<body>
  <div class="site-wrap">
    <h1>Interactive Player Map — 30 × 33</h1>
    <p class="help">Hover tiles to see player info. (Tap on mobile.) Place <code>pwnex.png</code> next to this file. Optional: add <code>players.json</code> to the same folder to supply live data.</p>

    <div id="map" class="map" aria-label="Player map"></div>

    <div class="footer">Coordinates: <code>x</code> from 0 (left) to 29 (right) — <code>y</code> from 0 (top) to 32 (bottom).<br>
    To update players, edit <code>players.json</code> or change the embedded sample data in this file.</div>
  </div>

  <script>
    // CONFIG
    const MAP_FILENAME = 'pwnex.png'; // image file placed next to index.html
    const COLS = 30;
    const ROWS = 33;
    const playersJsonPath = './players.json'; // can edit or remove

    // Example fallback player data (used if players.json not found)
    const samplePlayers = [
      { name: 'Sonsy', lastActive: '2h ago', x: 10, y: 6 },
      { name: 'Kuronaoki', lastActive: '5d ago', x: 5, y: 12 },
      { name: 'Nexus', lastActive: 'online', x: 20, y: 2 }
    ];

    // Build a quick lookup map keyed by `x,y`
    function makeLookup(arr){
      const m = new Map();
      for(const p of arr){
        if (typeof p.x === 'number' && typeof p.y === 'number'){
          m.set(`${p.x},${p.y}`, p);
        }
      }
      return m;
    }

    // Create tiles and attach hover behavior
    (function init(){
      const map = document.getElementById('map');
      // defensive: set background image path in case user renamed MAP_FILENAME
      map.style.backgroundImage = `url('${MAP_FILENAME}')`;

      // create tiles
      for(let y = 0; y < ROWS; y++){
        for(let x = 0; x < COLS; x++){
          const tile = document.createElement('div');
          tile.className = 'tile';
          tile.dataset.x = x; tile.dataset.y = y;

          // attach hover tooltip element
          const tip = document.createElement('div');
          tip.className = 'tooltip';
          tip.textContent = `x:${x} y:${y}`;
          tile.appendChild(tip);

          // mouseenter / mouseleave for desktop
          tile.addEventListener('mouseenter', () => showTip(tile, tip));
          tile.addEventListener('mouseleave', () => hideTip(tile, tip));

          // touch / click: toggle on small devices
          tile.addEventListener('click', (ev) => {
            // keep simulated hover for touch: toggle visibility
            if (tip.classList.contains('visible')){ hideTip(tile, tip) }
            else { showTip(tile, tip) }
            // prevent accidental map dragging while testing
            ev.stopPropagation();
          });

          map.appendChild(tile);
        }
      }

      // load players.json, fall back to samplePlayers
      fetch(playersJsonPath, {cache: 'no-store'})
        .then(r => { if(!r.ok) throw new Error('no json'); return r.json() })
        .then(data => {
          const lookup = makeLookup(data);
          window.__playerLookup = lookup;
        })
        .catch(err => {
          console.warn('players.json not found or failed to load — using embedded samplePlayers');
          window.__playerLookup = makeLookup(samplePlayers);
        });

      // hide any visible tips when tapping outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.tile')){
          document.querySelectorAll('.tooltip.visible').forEach(t => t.classList.remove('visible'));
        }
      });
    })();

    function showTip(tile, tip){
      const x = Number(tile.dataset.x); const y = Number(tile.dataset.y);
      const lookup = window.__playerLookup;
      if (lookup && lookup.has(`${x},${y}`)){
        const p = lookup.get(`${x},${y}`);
        tip.innerHTML = `<strong>${escapeHtml(p.name)}</strong> — ${escapeHtml(p.lastActive || '')}`;
      } else {
        tip.textContent = `x:${x} y:${y}`; // helpful coordinate fallback
      }
      tip.classList.add('visible');

      // ensure tooltip doesn't overflow the map container vertically (if near top row)
      // compute rects and adjust if necessary
      const mapRect = document.getElementById('map').getBoundingClientRect();
      const tipRect = tip.getBoundingClientRect();
      const tileRect = tile.getBoundingClientRect();

      // if tooltip would go above viewport, push it below the tile
      if (tipRect.top < mapRect.top + 6){
        tip.style.top = 'calc(100% + 8px)';
        tip.style.transform = 'translateX(-50%)';
      } else {
        tip.style.top = '-38px';
        tip.style.transform = 'translateX(-50%) translateY(0)';
      }
    }

    function hideTip(tile, tip){
      tip.classList.remove('visible');
      // reset top to default
      tip.style.top = '-38px';
    }

    function escapeHtml(s){
      if (!s && s !== 0) return '';
      return String(s).replace(/[&<>\"']/g, function(ch){
        return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[ch];
      });
    }

    // Utility: download current players.json structure as example (for advanced users)
    // (Uncomment to provide a download button.)
  </script>
</body>
</html>
